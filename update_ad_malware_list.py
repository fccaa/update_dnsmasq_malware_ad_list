#!/usr/bin/python3

import requests

# Getting Adaway

thelist = ["address=/"+y.split(" ")[1]+"/127.0.0.1" for y in list(filter(lambda x: len(x) > 0 and "#" not in x and not x.endswith(" localhost"), requests.get("https://adaway.org/hosts.txt").text.split("\n")))]                                                                                                                                                                
                                                                                                                                                                        
thelist = list(filter(None, thelist))                                                                                                                                   
                                                                                                                                                                        
outfile = open("/etc/dnsmasq.d/adaway.conf", "w")                                                                                                                       
                                                                                                                                                                        
for item in thelist:                                                                                                                                                    
        print(item, file=outfile)                                                                                                                                       
                                                                                                                                                                        
outfile.close()                                                                                                                                                         
                                                                                                                                                                        
# Getting List from someonewhocares.org                                                                                                                                 
                                                                                                                                                                        
raw_data = requests.get("https://someonewhocares.org/hosts/hosts").text.split("\n")

list_contain_tag = list()

for idx in range(len(raw_data)):
        if "</localhost>" in raw_data[idx]:
                list_contain_tag.append(idx)

raw_data = raw_data[list_contain_tag[0]+1:]

thelist = ["address=/"+y.split(" ")[1]+"/127.0.0.1" for y in list(filter(lambda x: len(x) > 0 and "#" not in x, raw_data))]

thelist = list(filter(None, thelist))

outfile = open("/etc/dnsmasq.d/someonewhocares.conf", "w")

for item in thelist:
        print(item, file=outfile)

outfile.close()

# Getting List from StevenBlack

raw_data = requests.get("https://raw.githubusercontent.com/StevenBlack/hosts/master/hosts").text.split("\n")

list_contain_tag = list()

for idx in range(len(raw_data)):
        if "# Start StevenBlack" in raw_data[idx]:
                list_contain_tag.append(idx)

raw_data = raw_data[list_contain_tag[0]+1:]

thelist = ["address=/"+y.split(" ")[1]+"/127.0.0.1" for y in list(filter(lambda x: len(x) > 0 and "#" not in x, raw_data))]

thelist = list(filter(None, thelist))

outfile = open("/etc/dnsmasq.d/StevenBlack.conf", "w")

for item in thelist:
        print(item, file=outfile)

outfile.close()

# Getting List from notracking

raw_data = requests.get("https://raw.githubusercontent.com/notracking/hosts-blocklists/master/dnsmasq/dnsmasq.blacklist.txt").text.split("\n")

thelist = list(filter(None, thelist))

thelist = ["address=/"+y.split("/")[1]+"/127.0.0.1" for y in list(filter(lambda x: len(x) > 0 and "#" != x[0], raw_data))]

outfile = open("/etc/dnsmasq.d/NoTracking.conf", "w")

for item in thelist:
        print(item, file=outfile)

outfile.close()

# Restart the local dns server

from os import system

system("service dnsmasq restart")

exit(0)
